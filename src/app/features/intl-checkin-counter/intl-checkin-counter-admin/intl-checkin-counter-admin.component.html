<div class="card flex flex-col sm:flex-row gap-8 h-full p-4">
  <div class="flex-4 flex flex-col overflow-hidden">
    <!-- 日期區間 -->
    <div class="flex items-center gap-2 ml-auto mb-1">
      <span class="text-sm font-semibold text-right">{{
        currentWeekRange
      }}</span>
      <app-calendar-trigger
        class="w-60"
        [selectedDate]="searchDate"
        [isAllDay]="true"
        [placeholder]="'-- -- --'"
        [title]="'日期(起)'"
        (dateChange)="onSearchDateChange($event)"
      ></app-calendar-trigger>
    </div>

    <!-- 航班 -->
    <div class="flex-1 p-2 bg-white">
      <div class="flex gap-2 pb-4 overflow-auto">
        @for (infoCard of infoCardList; track $index) {
          @if (infoCard.status == "核准中") {
            <div
              class="flex flex-col flex-shrink-0 items-center gap-3 p-2 sm:p-3 border-4 border-[#a99f96] rounded-2xl w-[160px] sm:w-[250px] overflow-hidden cursor-pointer"
              (click)="selectItem(infoCard.item)"
            >
              <h2
                class="mt-3 text-[40px] sm:text-[50px] font-semibold text-center leading-none break-all"
                [ngClass]="$even ? 'text-[#008743]' : 'text-[#0c77f9]'"
              >
                {{ infoCard.flightNo }}
              </h2>
              <span class="text-xl sm:text-[32px] text-black leading-none">{{
                infoCard.time
              }}</span>
              <span class="flex-1 text-md sm:text-xl text-center text-black">{{
                infoCard.date
              }}</span>
              <span
                class="w-full py-1 text-center text-md sm:text-2xl rounded-sm bg-[#c8c8c8]"
                >{{ infoCard.status }}</span
              >
            </div>
          }
        }
      </div>
    </div>

    <!-- Gantt Chart -->
    <div class="overflow-x-auto py-2 bg-white relative">
      <div class="flex w-fit min-w-full">
        <!-- 左側 row index 欄 -->
        <div class="sticky left-0 z-10 bg-white">
          <!-- header 空格 -->
          <div class="w-20 h-4"></div>

          <!-- 1~6 row label -->
          @for (row of ganttRows; track row) {
            <div
              class="w-20 h-10 flex items-center justify-center bg-[#00b2ee] text-lg text-white font-semibold"
              [ngClass]="$first ? '' : 'mt-2'"
            >
              {{ row }}
            </div>
          }
        </div>

        <!-- 日期 columns -->
        @for (day of ganttDays; track day.date) {
          <div class="shrink-0 min-w-[168px]">
            <!-- 日期 header -->
            <div
              class="h-4 flex items-center font-semibold text-sm text-black pl-2 whitespace-nowrap border-l-4 border-black"
            >
              {{ day.date }}
            </div>

            <!-- 6 rows -->
            @for (row of ganttRows; track row) {
              <div
                class="h-10 flex items-center justify-start px-1 bg-gray-100 gap-1"
                [ngClass]="$first ? '' : 'mt-2'"
              >
                @for (item of getItemsByRow(day, row); track $index) {
                  <div
                    class="w-20 h-9 bg-[#b2c8e8] flex flex-col items-center justify-center rounded"
                  >
                    <h4 class="text-md text-[#2f9e5d] font-bold">
                      {{ item.data.flightNo }}
                    </h4>
                    <span class="text-xs text-black">
                      {{ item.data.time }}
                    </span>
                  </div>
                }
              </div>
            }
          </div>
        }

        <!-- 右側補滿（6 rows） -->
        <div class="flex-1 shrink-0">
          <div class="h-4"></div>
          @for (row of ganttRows; track row) {
            <div
              class="h-10 bg-gray-100"
              [ngClass]="$first ? '' : 'mt-2'"
            ></div>
          }
        </div>
      </div>
    </div>
  </div>

  <!-- 申請內容 -->
  <div class="flex-3 flex flex-col flex-shrink-0 items-center pb-8 sm:pb-14">
    <h2
      class="text-2xl sm:text-4xl text-center w-[90%] py-4 sm:py-8 sm:mb-4 border-b-2 border-[#e69d30]"
    >
      核准內容
    </h2>

    <form
      class="flex flex-col gap-4 flex-1 min-h-0 w-full px-0.5 sm:px-13 mt-3 rounded-lg space-y-4 text-md sm:text-2xl"
      [formGroup]="form"
    >
      <div class="flex flex-col gap-4 flex-1 h-0 sm:pr-1 sm:py-1 overflow-auto">
        <!-- Row 1：航班資訊 / 起飛時間 -->
        <div
          class="grid grid-cols-[64px_1fr] sm:grid-cols-[1fr_2fr_1fr_1fr] gap-x-2 sm:gap-x-4 gap-y-4 items-center"
        >
          <label class="text-[#97e0fb] font-semibold [text-align-last:justify]"
            >航班資訊</label
          >
          <input
            type="text"
            class="w-full bg-[#193652] rounded px-2 py-1"
            formControlName="flightInfo"
          />
        </div>

        <div
          class="grid grid-cols-[64px_1fr] sm:grid-cols-[1fr_2fr_1fr_1fr] gap-x-2 sm:gap-x-4 gap-y-4 items-center"
        >
          <label class="text-[#97e0fb] font-semibold">起飛時間</label>
          <div class="flex items-center gap-1">
            <app-dropdown-secondary
              class="w-full"
              [value]="formData.departureTimeHour"
              [options]="hourOptions"
              (selectionChange)="onTimeChange('departureTime', 'HH', $event)"
            ></app-dropdown-secondary>
            <span>:</span>
            <app-dropdown-secondary
              class="w-full"
              [value]="formData.departureTimeMin"
              [options]="minOptions"
              (selectionChange)="onTimeChange('departureTime', 'mm', $event)"
            ></app-dropdown-secondary>
          </div>
        </div>

        <!-- Row 2：申請時段 -->
        <div
          class="grid grid-cols-[64px_1fr] sm:grid-cols-[1fr_2fr_1fr_1fr] gap-x-2 sm:gap-x-4 gap-y-4 items-center"
        >
          <label class="text-[#97e0fb] font-semibold [text-align-last:justify]"
            >申請時段</label
          >
          <div class="flex flex-1 items-center gap-1">
            <app-dropdown-secondary
              class="w-full"
              [value]="formData.startTimeHour"
              [options]="hourOptions"
              (selectionChange)="onTimeChange('startTime', 'HH', $event)"
            ></app-dropdown-secondary>
            <span>:</span>
            <app-dropdown-secondary
              class="w-full"
              [value]="formData.startTimeMin"
              [options]="minOptions"
              (selectionChange)="onTimeChange('startTime', 'mm', $event)"
            ></app-dropdown-secondary>
          </div>

          <div class="col-span-2 flex flex-1 items-center gap-1">
            <app-dropdown-secondary
              class="w-full"
              [value]="formData.endTimeHour"
              [options]="hourOptions"
              (selectionChange)="onTimeChange('endTime', 'HH', $event)"
            ></app-dropdown-secondary>
            <span>:</span>
            <app-dropdown-secondary
              class="w-full"
              [value]="formData.endTimeMin"
              [options]="minOptions"
              (selectionChange)="onTimeChange('endTime', 'mm', $event)"
            ></app-dropdown-secondary>
          </div>
        </div>

        <div
          class="grid grid-cols-[64px_1fr] sm:grid-cols-[1fr_2fr_1fr_1fr] gap-x-2 sm:gap-x-4 gap-y-4 items-center"
        >
          <label class="text-[#97e0fb] font-semibold [text-align-last:justify]"
            >星期</label
          >

          <div
            class="col-span-3 flex items-center justify-between w-full gap-2"
          >
            <!-- 星期陣列 -->
            @for (day of weekList; track day) {
              <label class="flex items-center gap-2 cursor-pointer">
                <input
                  type="checkbox"
                  class="hidden"
                  [formControl]="getWeekControl(day.key)"
                />

                <span
                  class="w-4 h-4 rounded-full border-2 flex items-center justify-center bg-white"
                >
                  <span
                    *ngIf="getWeekControl(day.key)?.value"
                    class="w-3 h-3 rounded-full bg-[#0a80c4]"
                  ></span>
                </span>

                <span class="text-[#97e0fb]">{{ day.label }}</span>
              </label>
            }
          </div>
        </div>

        <!-- Row 3：申請日期 -->
        <div
          class="grid grid-cols-[64px_1fr] sm:grid-cols-[1fr_2fr_1fr_1fr] gap-x-2 sm:gap-x-4 gap-y-4 items-center"
        >
          <label class="text-[#97e0fb] font-semibold [text-align-last:justify]"
            >申請日期</label
          >
          <input
            type="text"
            class="sm:col-span-3 w-full bg-[#193652] rounded px-2 py-1 w-24"
            formControlName="applyDateInterval"
          />
        </div>

        <!-- Row 4：申請項目 -->
        <div
          class="grid grid-cols-[64px_1fr] sm:grid-cols-[1fr_2fr_1fr_1fr] gap-x-2 sm:gap-x-4 gap-y-4 items-center"
        >
          <label class="text-[#97e0fb] font-semibold [text-align-last:justify]"
            >申請項目</label
          >
          <ng-container>
            <!-- @for (ctrl of seasonCountersFA.controls; track $index) {
            <div
              [formGroupName]="$index"
              class="sm:col-start-2 col-span-3 flex items-center gap-x-2 sm:gap-x-4"
            >
              <label
                class="flex flex-shrink-0 items-center gap-2 cursor-pointer"
              >
                <input
                  type="checkbox"
                  class="hidden"
                  formControlName="checked"
                />

                <span
                  class="w-4 h-4 rounded-full border-2 flex items-center justify-center bg-white"
                >
                  @if (ctrl.value.checked) {
                  <span class="w-3 h-3 rounded-full bg-[#0a80c4]"></span>
                  }
                </span>

                <span class="text-[#97e0fb] select-none">島櫃</span>
              </label>

              <input
                type="text"
                class="bg-[#193652] rounded px-2 py-1 w-12"
                formControlName="assignedCounterArea"
                [disabled]="!ctrl.value.checked"
              />

              <label class="flex-shrink-0 text-[#97e0fb] font-semibold"
                >櫃檯</label
              >

              <div class="flex items-center gap-2">
                <input
                  type="text"
                  class="bg-[#193652] rounded px-2 py-1 w-full"
                  formControlName="counterFrom"
                  [disabled]="!ctrl.value.checked"
                />
                <span>-</span>
                <input
                  type="text"
                  class="bg-[#193652] rounded px-2 py-1 w-full"
                  formControlName="counterTo"
                  [disabled]="!ctrl.value.checked"
                />
              </div>
            </div>
            } -->
            <div
              class="sm:col-start-2 col-span-3 flex items-center gap-x-2 sm:gap-x-4"
            >
              <span class="flex-shrink-0 text-[#97e0fb] select-none">島櫃</span>
              <input
                type="text"
                class="bg-[#193652] rounded px-2 py-1 flex-1 w-0"
                formControlName="assignedCounterArea"
              />
              <app-dropdown-secondary [options]="islandOptions" (selectionChange)="onSeasonChange($event)"></app-dropdown-secondary>

              <label class="flex-shrink-0 text-[#97e0fb]">櫃檯</label>

              <input
                type="text"
                class="bg-[#193652] rounded px-2 py-1 flex-1 w-0"
                formControlName="assignedCounterBooth"
              />
            </div>
          </ng-container>
        </div>
      </div>

      <div class="flex flex-col gap-4">
        <div class="sm:px-15 grid grid-cols-3 gap-4 w-full">
          <button
            class="text-sm sm:text-2xl py-1 bg-[#f5a830] rounded-sm cursor-pointer hover:bg-[#f2a020]"
            (click)="onApproval(true)"
          >
            核准
          </button>
          <button
            class="text-sm sm:text-2xl py-1 bg-[#f5a830] rounded-sm cursor-pointer hover:bg-[#f2a020]"
            (click)="onApproval(false)"
          >
            駁回
          </button>
          <button
            class="text-sm sm:text-2xl py-1 bg-[#f5a830] rounded-sm cursor-pointer hover:bg-[#f2a020]"
            (click)="onModify()"
          >
            修改
          </button>
        </div>

        <!-- Row 6：駁回理由 -->
        <div
          class="grid grid-cols-[64px_1fr] sm:grid-cols-[1fr_2fr_1fr_1fr] gap-x-2 sm:gap-x-4 gap-y-4 items-center w-full"
        >
          <label class="text-[#97e0fb] font-semibold">駁回理由</label>
          <input
            type="text"
            class="sm:col-span-3 w-full bg-[#193652] rounded px-2 py-1 w-24"
            formControlName="reason"
          />
        </div>
      </div>
    </form>

    <div class="w-[90%] my-4 sm:my-6 border-b-2 border-[#e69d30]"></div>

    <div class="sm:px-15 grid grid-cols-3 gap-4 w-full">
      <button
        class="col-start-2 text-sm sm:text-2xl py-1 bg-[#f5a830] rounded-sm cursor-pointer hover:bg-[#f2a020]"
      >
        匯出EXCEL
      </button>
    </div>
  </div>
</div>
